
<%- include('partials/head') %>



<body>
  
        <div class="container d-block justify-content-start " id="container">
                        
          <div class="d-flex justify-content-center">
                    <a href=""><img style="width: 300px; height: 200px;" src="/user/imgs/theme/logo.png" alt="logo"></a>
          </div>
          <div class="d-block text-center">
          <h1><%= reportType  %></h1>
          <p><%= from  %> - <%= to  %></p>
        </div>
          <div class="">
                    <div class="row hide-on-print">
                      
                              
                        <div class="col-md-3">
                            <span>From: <%= from  %></span>
                            <div class="datepicker date input-group p-0 shadow-sm" style="width: 300px;">
                                <input id="fromDate" type="text" placeholder="Choose a date" class="form-control py-4 px-4" />
                                <div class="input-group-append">
                                    <span class="input-group-text px-4">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="">
                                <p id="showFromDate" hidden>From : <%= from  %></p>
                                <input id="inputFrom" type="text" value="" hidden>
                            </div>
                        </div>
                
                        <div class="col-md-3 ml-60">
                            <span>To: <%= to %></span>
                            <div class="datepicker date input-group p-0 shadow-sm" style="width: 300px;">
                                <input id="toDate" type="text" placeholder="Choose a date" class="form-control py-4 px-4" />
                                <div class="input-group-append">
                                    <span class="input-group-text px-4">
                                        <i class="fa fa-calendar"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="">
                                <p id="showToDate" hidden>To :</p>
                                <input id="inputTo" type="text" value="" hidden>
                            </div>
                        </div>
                        <div>
                        <select style="width: 300px; margin-top: 10px;" class="custom-select" name="typeOfReport" id="typeOfReport" onchange="setDateRange()">
                            <option value="daily">Get Daily Report</option>
                            <option value="weekly">Get Weekly Report</option>
                            <option value="monthly">Get Monthly Report</option>
                            <option value="yearly">Get Yearly Report</option>
                        </select>
                    </div>
                        
           
                  
                    </div>
                    <div class="hide-on-print mt-20">
                    <button  style="width: 300px;" id="goButton" onclick="getReport()" type="submit" class="btn btn-primary ">Go</button>
                </div>
                </div>
               
                <script>
                    $(".datepicker").datepicker({
                        clearBtn: true,
                        format: "dd/mm/yyyy",
                    });
                
                    $("#fromDate, #toDate").on("change", function() {
                        let from = $("#fromDate").val();
                        let to = $("#toDate").val();
                        $("#showFromDate").text(`${from}`);
                        $("#inputFrom").text(`${from}`);
                        $("#showToDate").text(`${to}`);
                        $("#inputTo").text(`${to}`);
                        $('#fromToDate').text(`${from}`)
                        $('#toFromDate').text(`${to}`)
                    });
                </script>
                
          
          <section class="mt-50 mb-50">

                            
                      
                    
                
               
                    <div class="">
                              
                       
                        <div style="margin-top: -70px;" class="row">
                              <div class="col-lg-3 col-sm-6">
                              
                                       
                              </div></div></section>


  
        <section class="mt-50 mb-50">
        
            <div class="">
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            
                            <div class=" p-md-4 p-30 border-radius cart-totals">
                              <div class="heading_s1 mb-3">
                                  <h4>Order Overview</h4>
                              </div>
                           
                              
                                  <table class="" id="testtable">
                                      <tbody>
                                        <% if(productsRevenue&& productsRevenue.length > 0){ %>
                                          <tr>
                                              <td class="cart_total_label">Date</td>
                                              <td>  <%= from  %> - <%= to  %> </td>

                                          </tr>
                                          <tr>
                                              <td class="cart_total_label">Revenue </td>
                                              <td><%= revenue[0].totalEarnings  %></td>
                                          </tr>

                                          <tr>
                                            <td class="cart_total_label">Order </td>
                                            <td><%= revenue[0].totalOrders  %></td>
                                        </tr>



                                          <tr>
                                              <td class="cart_total_label">Average Order Value</td>
                                              <td><%= parseInt(revenue[0].totalEarnings / revenue[0].totalOrders) %></td>

                                             
                                          </tr>
                                          <% } %>
                                      </tbody>
                                  </table>
                              </div>
                        </div>

                        <div class="table-responsive" id="testtable2">
                            <table class="table shopping-summery text-center clean bordered-table">
                                <thead>
                                    <tr class="main-heading">
                                        <th scope="col">Product Id</th>
                                        <th scope="col">Product Name</th>
                                        <th scope="col">Quantity sold</th>
                                        <th scope="col">Total Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if(productsRevenue && productsRevenue.length > 0){ %>
                                        <% for(let i=0; i<productsRevenue.length; i++){ %>
                                            <tr>
                                                <td><%= productsRevenue[i]._id  %></td>
                                                <td><%= productsRevenue[i].productName  %></td>
                                                <td><%= productsRevenue[i].totalQuantity  %></td>
                                                <td><%= productsRevenue[i].totalRevenue %></td>
                                            </tr>
                                        <% } %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="4" class="text-center">No reports yet</td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        
                      


                       
                        <div class="divider center_icon mt-50 mb-50"></div>
                        <div class="row mb-50">
                            
                                   
                               
                             
                            </div>
                            <div class="col-lg-12 col-md-12">
                                <div class="border p-md-4 p-30 border-radius cart-totals">
                                    <div class="heading_s1 mb-3">
                                        <h4>Profit Details</h4>
                                    </div>
                                 
                                    
                                        <table class="table" id="testtable3">
                                            <tbody>
                                                <% if(profit && profit.length>0){%>
                                                <tr>
                                                    <td class="cart_total_label">Total Revenue</td>
                                                    <td><%= profit[0].totalRevenue  %></td>

                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Total Cost </td>
                                                    <td><%= profit[0].totalCost  %></td>
                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Gross Profit</td>
                                                    <td><%= profit[0].totalProfit  %></td>

                                                    <input type="number" name="totalamountcheckout" value="" id="totalinputfield" hidden>
                                                </tr>
                                                <% }else{ %>
                                                    <p>No details available</p>
                                                    <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                   <div class="row">
                                        <div class="col-2 hide-on-print d-flex">
                                            <button class="btn btn-primary custom-btn" type="button" style="margin-top: 10px;" id="printButton">Print Invoice</button>

                                            <button class="btn btn-danger custom-btn" style="margin-left: 20px; margin-top: 10px;" onclick="download()">Download Excel</button>
                                            
                                            
                                </div>
                                   
                                   
                                 
                                
                               
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </form>
        </section>
    </main>
</div>
   
  
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function setDateRange() {
            const selectedReport = $("#typeOfReport").val();
            const today = new Date();
            let fromDate, toDate;
          
        
            const padZero = (num) => (num < 10 ? `0${num}` : num);
        
            if (selectedReport === "daily") {
                fromDate = `${padZero(today.getDate())}/${padZero(today.getMonth() + 1)}/${today.getFullYear()}`;
                toDate = `${padZero(today.getDate() + 1) }/${padZero(today.getMonth() + 1)}/${today.getFullYear()}`;
             
            } else if (selectedReport === "weekly") {
                // Calculate the start and end of the week
                const startOfWeek = new Date(today);
                const endOfWeek = new Date(today);
                const dayOfWeek = today.getDay(); // Sunday is 0, Monday is 1, etc.
                const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Adjust for Sunday
        
                startOfWeek.setDate(diff);
                endOfWeek.setDate(diff + 6);
        
                fromDate = `${padZero(startOfWeek.getDate())}/${padZero(startOfWeek.getMonth() + 1)}/${startOfWeek.getFullYear()}`;
                toDate = `${padZero(endOfWeek.getDate() + 1)}/${padZero(endOfWeek.getMonth() + 1)}/${endOfWeek.getFullYear()}`;
             
            } else if (selectedReport === "monthly") {
                // Calculate the start and end of the month
                const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        
                fromDate = `${padZero(startOfMonth.getDate())}/${padZero(startOfMonth.getMonth() + 1)}/${startOfMonth.getFullYear()}`;
                toDate = `${padZero(endOfMonth.getDate())}/${padZero(endOfMonth.getMonth() + 1)}/${endOfMonth.getFullYear()}`;
              
            } else if (selectedReport === "yearly") {
                // Calculate the start and end of the year
                fromDate = `01/01/${today.getFullYear()}`;
                toDate = `31/12/${today.getFullYear()}`;
               
            }
        
            // Set the values in the input fields or update elements as needed
            $("#fromDate").val(fromDate);
            $("#toDate").val(toDate);
        
            // Update other elements if needed
            $("#showFromDate").text(fromDate);
            $("#showToDate").text(toDate);
            $("#inputFrom").val(fromDate);
            $("#inputTo").val(toDate);
            
          
            
        }
        
   
        setDateRange();
        </script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

   <script>
 
    // function setDefaultReportType() {
    //     const typeOfReport = localStorage.getItem('selectedReport');
    //     const typeOfReportElement = document.getElementById('typeOfReport');
    
    //     if (typeOfReport) {
    //         typeOfReportElement.value = typeOfReport;
    //     } else {
           
    //         localStorage.setItem('selectedReport', typeOfReportElement.value);
    //     }
    
    
    //     typeOfReportElement.addEventListener('change', function() {
    //         localStorage.setItem('selectedReport', this.value);
    //     });
    // }
    
    // // Call the function to set default value and store selected value
    // setDefaultReportType();
    </script>
   <script>




    async function getReport() {
        try {
            const fromDate = document.getElementById('showFromDate').innerHTML;
            const toDate = document.getElementById('showToDate').innerHTML;
    
            const requestBody = {
                fromDate,
                toDate
            };
    
            const response = await fetch('/admin/getReport', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
    
            if (!response.ok) {
                throw new Error('Failed to fetch data');
            }
    
            const data = await response.json();
    
            // Redirect to getReportResults and update the report type
            window.location.assign('/admin/getReportResults');
        //     const typeOfReport = document.getElementById('typeOfReport').value;
        
        // localStorage.setItem('selectedReport', typeOfReport);
    
        } catch (error) {
            console.error('Error:', error);
    
            if (error.message === 'Failed to fetch data') {
                Swal.fire({
                    icon: 'error',
                    title: 'Invalid Date Range',
                    text: 'From date cannot be greater than to date',
                    showConfirmButton: true
                });
            }
            location.reload()
        }
    }
    </script>


        

    <!-- Vendor JS-->
    <script src="/user/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="/user/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="/user/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="/user/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="/user/js/plugins/slick.js"></script>
    <script src="/user/js/plugins/jquery.syotimer.min.js"></script>
    <script src="/user/js/plugins/wow.js"></script>
    <script src="/user/js/plugins/jquery-ui.js"></script>
    <script src="/user/js/plugins/perfect-scrollbar.js"></script>
    <script src="/user/js/plugins/magnific-popup.js"></script>
    <script src="/user/js/plugins/select2.min.js"></script>
    <script src="/user/js/plugins/waypoints.js"></script>
    <script src="/user/js/plugins/counterup.js"></script>
    <script src="/user/js/plugins/jquery.countdown.min.js"></script>
    <script src="/user/js/plugins/images-loaded.js"></script>
    <script src="/user/js/plugins/isotope.js"></script>
    <script src="/user/js/plugins/scrollup.js"></script>
    <script src="/user/js/plugins/jquery.vticker-min.js"></script>
    <!-- Template  JS -->
    <script src="/user/js/maind134.js?v=3.4"></script>
    <script src="/user/js/shopd134.js?v=3.4"></script>

<script src="https://unpkg.com/xlsx@0.9.8/dist/xlsx.core.min.js"></script>
    <script src=" https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js "></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-style@0.8.13/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.4/xlsx.full.min.js"></script>

<script>
function download() {
    
    var table1 = document.getElementById("testtable");
    var table2 = document.getElementById('testtable2');
    var table3 = document.getElementById('testtable3');

    var workbook1 = XLSX.utils.table_to_book(table1);
    var workbook2 = XLSX.utils.table_to_book(table2);
    var workbook3 = XLSX.utils.table_to_book(table3);

    var ws1 = workbook1.Sheets["Sheet1"];
    var ws2 = workbook2.Sheets["Sheet1"];
    var ws3 = workbook3.Sheets["Sheet1"];



  
    var mergedWorkbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(mergedWorkbook, ws1, "Table1");
    XLSX.utils.book_append_sheet(mergedWorkbook, ws2, "Table2");
    XLSX.utils.book_append_sheet(mergedWorkbook, ws3, "Table3");

   
    XLSX.writeFile(mergedWorkbook, "SalesReport.xlsx"); 
}



</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
    let printLink = document.getElementById("printButton");
    let container = document.getElementById("container");

    printLink.addEventListener("click", event => {
        event.preventDefault();
        printLink.style.display = "none";
        window.print();
    }, false);

    container.addEventListener("click", event => {
        printLink.style.display = "flex";
    }, false);

}, false);

</script>



  




  
  
  
  
      
      
  
      
      
      
      

</body>


<!-- Mirrored from wp.alithemes.com/html/evara/evara-frontend/shop-cart.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 15 Jul 2023 10:10:07 GMT -->
</html>