




<%- include('partials/head') %>



<body>




        
                        
          <div class="d-flex justify-content-center">
                    <a href=""><img style="width: 300px; height: 200px;" src="/user/imgs/theme/logo.png" alt="logo"></a>
          </div>
          <section class="mt-50 mb-50">
               
                    <div class="container">
                        <% if(orders && orders.length>0 ){ %>
                      <% let totalAmount = 0 %>
         <% for(let i = 0; i < orders.length; i++) { %>
                        <div style="margin-top: -70px;" class="row">
                              <div class="col-lg-3 col-sm-6">
                              
                                        <h5>Bill To</h5>
                                    <p>Name : <%= orders[i].address.name%></p>
                                    <p>Phone : <%= orders[i].address.phone%></p>
                                    <p>Address : <%= orders[i].address.Address%></p>
                                    <p>City : <%= orders[i].address.city%></p>
                                    <p>State : <%= orders[i].address.state%></p>
                                    <p>Pin Code : <%= orders[i].address.pincode%></p>
                                    <p>Landmark : <%= orders[i].address.landmark%></p>
                                       </div>
                                       <div class="col-lg-3 col-sm-6">
                                        <h5>Ship To</h5>
                                        <p>Name : <%= orders[i].address.name%></p>
                                        <p>Phone : <%= orders[i].address.phone%></p>
                                        <p>Address : <%= orders[i].address.Address%></p>
                                        <p>City : <%= orders[i].address.city%></p>
                                        <p>State : <%= orders[i].address.state%></p>
                                        <p>Pin Code : <%= orders[i].address.pincode%></p>
                                        <p>Landmark : <%= orders[i].address.landmark%></p>
                              </div>
                              </div></div></section>


  
        <section class="mt-50 mb-50">
        
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table shopping-summery text-center clean">
                                <thead>
                                    <tr class="main-heading">
                                        <th scope="col">Image</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Quantity</th>
                                        <th scope="col">Subtotal</th>
                                        <th scope="col">Status</th>
                                        <th scope="col" id="returnhideheader">Action</th>
                                     
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (orders && orders.length > 0) { %>
                                        <% orders.forEach(order => { %>
                                            <% if (order.items && order.items.length > 0) { %>
                                                <% order.items.forEach(item => { %>
                                                 
                                                        
                                                        <tr>
                                                            <input type="text" value="<%= item.productId %>" id="" hidden>
                                                            <td class="image product-thumbnail">
                                                                <img  src="/<%= item.productId.images[0] %>" alt="#">
                                                            </td>
                                                            <td class="product-des product-name">
                                                                <h5 class="product-name">
                                                                    <a href="shop-product-right.html"><%= item.productId.productName %></a>
                                                                </h5>
                                                                <p class="font-xs"><%= item.size  %><br> <%= item.productId.shortDescription  %></p>
                                                            </td>
                                                            <td class="price" data-title="Price"><span>&#8377;<%= item.price %></span></td>
                                                            <td class="quantity" data-title="Quantity"><span><%= item.quantity %></span></td>
                                                            <td class="text-right" data-title="Cart">
                                                                <span class="calctotal" id="calcprice">&#8377;<%= item.price * item.quantity %></span>
                                                            </td>
                                                            <td class="text-right" data-title="Status">
                                                                <span class="status" id="status"><%= item.status  %></span>
                                                                
                                                            </td>
                                                        
                                                            <% if(item.status !== 'Cancelled' && item.status !== 'Returned' && item.status !== 'Requested for cancellation'){ %>
                                                            <% if(item.status === 'Delivered' ) {%>
                                                                <% if(item.returnExpiry !== null){ %>
                                                                 
                                                             
                                                                        <td id="returnhide" class="cancel" data-title="Cancel">
                                                                    <button class="btn btn-danger" id="myBtn" >Return</button>
                                                                    <br>
                                                                    <span class="text-muted">Return request should  <br>
                                                                         be placed within <%= ((item.returnExpiry).toString()).slice(0,16)  %></span>
                                                                    
                                                                    <!-- <button class="btn btn-danger" style="background-color: rgba(166, 4, 4, 0.712)" onclick="returnOrder('<%= item._id %>')">Return</button> -->
                                                                </td>
                                                              
                                                                <div id="myModal" class="modal">

                                                                    <!-- Modal content -->
                                                                    <div class="modal-content">
                                                                      <span class="close">&times;</span>
                                                                      <form>
                                                                        <input type="text" style="margin-bottom: 30px;" name="cancellation" id="reasonForReturn" placeholder="Reason for returning the product?">
                                                                           <button class="btn btn-danger" onclick="returnOrder('<%= item._id %>')">Request Return</button>
                                                                       
                                                                      </form>
                                                                    
                                                                    </div>
                                                                  
                                                                  </div>
                                                                  <% }else {%>
                                                                    <td>Return expired, you can no longer return this item!</td>
                                                                    <% } %>

                                                               
                                                                <% }else{ %>
                                                            <td class="cancel" data-title="Cancel">
                                                                <!-- <button class="btn btn-danger" onclick="cancelOrder('<%= item._id %>')">Cancel</button> -->
                                                                <button class="btn btn-danger" id="myBtn" >Cancel</button>
                                                                
                                                            </td>
                                                            <div id="myModal" class="modal">

                                                                <!-- Modal content -->
                                                                <div class="modal-content">
                                                                  <span class="close">&times;</span>
                                                                  <form>
                                                                    <input type="text" style="margin-bottom: 30px;" name="cancellation" id="reason" placeholder="Reason for cancellation">
                                                                       <button class="btn btn-danger m-10 p-10" onclick="cancelOrder('<%= item._id %>')">Cancel</button>
                                                                    <button>
                                                                  </form>
                                                                </div>
                                                              
                                                              </div>
                                                              
                                                            <% } %>
                                                            <% } else { %>

                                                                <% if(item.status === 'Requested for cancellation') {%>

                                                               <td>Item requested for cancellation.</td>
                                                               <%} else if(item.status === 'Cancelled'){ %>
                                                                <td>Item cancelled</td>
                                                                <% } else if(item.status === 'Returned') { %>
                                                                    <td>Item Returned</td>
                                                                    <% } %>
                                                                    <% } %>
                                                              

                                                              
                                                       
                                                            
                                                        </tr>
                                               
                                                <% }) %>
                                            <% } %>
                                        <% }) %>
                                    <% } %>
                                </tbody>
                                
                                
                            </table>
                        </div>
                      

                       
                       
                        <div class="divider center_icon mt-50 mb-50"></div>
                        <div class="row mb-50">
                            
                                   
                               
                             
                            </div>
                            <div class="col-lg-12 col-md-12">
                                <div class="border p-md-4 p-30 border-radius cart-totals">
                                    <div class="heading_s1 mb-3">
                                        <h4>Bill Totals</h4>
                                    </div>
                                    <div>
                            <% orders.forEach(order => {  %>
                          <%   order.items.forEach(item => {  %>
                                 
                                  <%  totalAmount += item.price * item.quantity; %>
                                
                            <%    });%>
                          
                        </div>
                                    
                                        <table class="table">
                                            <tbody>
                                                <tr>
                                                    <td class="cart_total_label">Bill Subtotal</td>
                                                <input type="number" value="<%= totalAmount %>" name="totalAmount" hidden>
                                                    <td class="cart_total_amount"><span id="showtotal" class="font-lg fw-900 text-brand"></span>&#8377;<%= totalAmount %></td>
                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Shipping</td>
                                                    <td class="cart_total_amount"> <i class="ti-gift mr-5"></i> Free Shipping</td>
                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Total</td>
                                                    <td class="cart_total_amount"><span id="showtotalamount" class="font-lg fw-900 text-brand">

                                                        <% if(order.couponApplied === true){ %>
                                                            <span style="font-size: 10px;" class="text-dark">Order availled with coupons will be cancelled upon cancelling or return of any of the product in the order</span>
<br>
                                                            <span  style="font-size: 8px; margin-top: -10px;"> Coupon : <span style="font-size: 12px; color: black;"> <%=order.couponName%> </span>Applied!</span><br>
                                                            <% } %>
                                                    </span><span class="fs-4">&#8377;<%= order.totalAmount  %></span></td>
                                                    <input type="number" name="totalamountcheckout" value="" id="totalinputfield" hidden>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <div class="row">
                                        <div class="col-lg-2 mt-10">
                                            <% if(order.orderStatus === 'Delivered'){ %>
                                    <input type="button" class="btn btn-primary" id="printbtn" onclick="printInvoice()"  value="Print Invoice">
                                    <% } %>
                              </div>
                                   
                                   
                                 
                          <%  }); %>
                               
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </form>
        </section>
    </main>
    <% } %>
    <% } %>
  
 
    <%- include('partials/mainScripts') %>


<!-- modal -->
<script src="/user/helpers/orderDetails.js">
  
</script>





    

    
    






  
  
  
  
      
      
  
      
      
      
      

</body>


</html>